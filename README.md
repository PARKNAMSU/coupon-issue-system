# Coupon Issuance System

## 프로젝트 구조

### service 
클라이언트 요청을 받고 응답을 보내는 역할 수행

### usecase
프로그램의 비즈니스 로직을 처리하는 역할 수행

### repository
데이터와 통신하여 데이터 삽입 및 호출하는 역할 수행

## 비즈니스 로직 설명

### CreateCampaign(캠페인 생성)
* 전달받은 캠페인 시작 날짜 string 을 time.Time 타입으로 변환
* 클라이언트에서 전달받은 데이터로 캠페인 생성
* 캠페인 id 전달

### UpdateCampaign(캠페인 수정)
* 전달받은 캠페인 시작 날짜 string 을 time.Time 타입으로 변환
* 클라이언트에서 전달받은 데이터로 해당 id 에 맞는 캠페인 업데이트
* 완료 메세지 전달

### GetCampaign(캠페인 검색)
* 전달받은 캠페인 id 에 맞는 캠페인 데이터 검색
* 해당 캠페인에 포함된 쿠폰 목록 검색
* 쿠폰 목록이 포함된 캠페인 데이터 전달

### IssueCoupon(쿠폰 발급)
1. 전달받은 캠페인 id 에 맞는 캠페인 데이터 검색
    * 캠페인데이터와 해당 캠페인에 맞는 쿠폰 목록 함께 검색
2. 캠페인 검증 실행
    * 캠페인 오픈날짜 확인
    * 캠페인이 열려있는 상태인지 확인
    * 현재 등록된 쿠폰 개수와 캠페인 최대 쿠폰 등록 개수 확인
3. 검증이 완료된 경우 쿠폰 object 생성하여 작업 큐에 삽입(비동기 호출)
4. 발급 요청 완료 메세지 전달
5. 쿠폰 발급의 경우 작업 큐를 통해 진행되므로 클라이언트 응답과는 별개임.
6. 발급 요청 후 쿠폰 발급 진행 순서
    * 큐에 순차적으로 쿠폰 발급 데이터 Inqueue
    * 큐에 쌓인 데이터를 순차적으로 Dequeue 진행
    * 쿠폰 발급 데이터를 꺼내온 후 한번 더 2.(캠페인 검증) 실행
    * 검증이 완료된 경우 데이터를 쿠폰 테이블에 삽입
    * 삽입 후 데이터에 포함된 전달할 계정과 방법으로 클라이언트에게 쿠폰 지급 완료 알림 발송